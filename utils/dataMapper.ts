
import { bookPages, sectionToc } from '../constants/bookData';
import { CourseModule, Page, QuizQuestion, UserProgress } from '../types';

// Specific Quiz Generator
const getQuizForSection = (sectionId: string): QuizQuestion[] | undefined => {
  switch (sectionId) {
    case 'face1': // Intention (النية)
      return [
        {
          id: 'face1-q1',
          question: 'وفقاً لنموذج بدرية، ما هو الدور الأساسي لـ "النية" في ريادة الأعمال؟',
          options: [
            'مجرد فكرة عابرة قبل البدء',
            'البوصلة الداخلية التي توجه العمل وتضمن استدامته',
            'شرط قانوني لتسجيل الشركة',
            'وسيلة لتحقيق الربح السريع فقط'
          ],
          correctAnswerIndex: 1,
          explanation: 'النية هي الأساس والبوصلة التي توجه كل القرارات اللاحقة، وهي التي تحول العادات إلى عبادات وتضمن البركة والاستدامة.'
        },
        {
          id: 'face1-q2',
          question: 'ما العلاقة بين "نية العطاء" ونجاح المشروع الريادي؟',
          options: [
            'نية العطاء تقلل من أرباح المشروع',
            'لا توجد علاقة مباشرة بينهما',
            'نية العطاء تعزز السمعة، تجذب الدعم، وتبني علاقات قوية مستدامة',
            'العطاء يجب أن يكون بعد تحقيق الثراء فقط'
          ],
          correctAnswerIndex: 2,
          explanation: 'المشاريع القائمة على نية العطاء وقيمة النفع غالباً ما تحظى بقبول مجتمعي أكبر، ولاء عملاء أعلى، وتوفيق في العمليات.'
        },
        {
          id: 'face1-q3',
          question: 'كيف يؤثر حديث "إنما الأعمال بالنيات" على سلوك رائد الأعمال؟',
          options: [
            'يجعله يركز على المظهر الخارجي فقط',
            'يعزز الرقابة الذاتية، المسؤولية، والصدق في التعاملات',
            'يجعله يتجاهل التخطيط المالي',
            'لا يؤثر إلا في العبادات الدينية'
          ],
          correctAnswerIndex: 1,
          explanation: 'الحديث يرسخ مبدأ أن القيمة الحقيقية للعمل تكمن في الباعث له، مما يعزز النزاهة والرقابة الذاتية في العمل التجاري.'
        }
      ];

    case 'face2': // Personal Advantages (المميزات الذاتية)
      return [
        {
          id: 'face2-q1',
          question: 'لماذا تُعتبر اختبارات مقاييس الشخصية (مثل PDA) ضرورية قبل تأسيس الفريق؟',
          options: [
            'لإضاعة الوقت في الإجراءات الإدارية',
            'لتحديد نقاط القوة والضعف ووضع الشخص المناسب في المكان المناسب',
            'لمعرفة من يستحق راتباً أعلى',
            'لتقليد الشركات الكبرى فقط'
          ],
          correctAnswerIndex: 1,
          explanation: 'فهم أنماط الشخصية يساعد في تشكيل فرق عمل متكاملة حيث تغطي نقاط قوة شخص ما نقاط ضعف شخص آخر.'
        },
        {
          id: 'face2-q2',
          question: 'ما هي الفائدة الرئيسية من التنوع في بيئة العمل الريادية؟',
          options: [
            'زيادة الصراعات والمشاكل',
            'تقليل تكاليف التوظيف',
            'زيادة الإبداع وتعدد وجهات النظر لحل المشكلات',
            'توحيد طريقة التفكير لتكون نمطية'
          ],
          correctAnswerIndex: 2,
          explanation: 'التنوع يخلق بيئة غنية بالأفكار المختلفة، مما يعزز الابتكار ويمنع التفكير النمطي المحدود.'
        },
        {
          id: 'face2-q3',
          question: 'القائد الناجح هو الذي:',
          options: [
            'يقوم بكل الأعمال بنفسه',
            'يفهم مميزاته الذاتية ومميزات فريقه ويوجههم بناءً عليها',
            'يصدر الأوامر دون نقاش',
            'يركز فقط على الأرقام المالية'
          ],
          correctAnswerIndex: 1,
          explanation: 'القيادة الحقيقية في هذا النموذج تعتمد على الوعي الذاتي والقدرة على استثمار الطاقات البشرية بذكاء.'
        }
      ];

    case 'face3': // Passion (الشغف)
      return [
        {
          id: 'face3-q1',
          question: 'لماذا يفضل المستثمرون رواد الأعمال "الشغوفين"؟',
          options: [
            'لأنهم يتحدثون كثيراً',
            'لأن الشغف مؤشر على المثابرة والقدرة على تجاوز الأزمات',
            'لأنهم يقبلون بأموال أقل',
            'لأن الشغف يعني عدم الحاجة لخطط عمل'
          ],
          correctAnswerIndex: 1,
          explanation: 'المستثمر يعلم أن ريادة الأعمال صعبة، والشغف هو الوقود الذي يضمن أن الرائد لن يستسلم عند أول عقبة.'
        },
        {
          id: 'face3-q2',
          question: 'الشغف الحقيقي في ريادة الأعمال يتمثل في:',
          options: [
            'مجرد حب الفكرة والاستمتاع بها',
            'الاستمرار والعمل الجاد والتعلم المستمر لتحويل الحلم لواقع',
            'الحديث عن المشروع للأصدقاء فقط',
            'ترك الوظيفة دون تخطيط'
          ],
          correctAnswerIndex: 1,
          explanation: 'الشغف ليس شعوراً فقط، بل هو فعل مستمر، التزام، وقدرة على التحمل والعمل الجاد.'
        },
        {
          id: 'face3-q3',
          question: 'كيف يحافظ رائد الأعمال على شغفه متقداً؟',
          options: [
            'عن طريق تجاهل العملاء',
            'بالاحتفال بالانتصارات الصغيرة والتعلم المستمر وتذكر "الغاية"',
            'بالعمل 24 ساعة دون راحة',
            'بتجنب التغيير أو التطوير'
          ],
          correctAnswerIndex: 1,
          explanation: 'الاحتفاء بالإنجازات وتجديد النية والتعلم المستمر يساعد في تجنب الاحتراق الوظيفي والحفاظ على الشغف.'
        }
      ];

    case 'face4': // Skills (المهارات)
      return [
        {
          id: 'face4-q1',
          question: 'ما الفرق الجوهري بين "المهارة" و "التخصص" في سياق النموذج؟',
          options: [
            'لا يوجد فرق، هما نفس الشيء',
            'المهارة هي الأداة (كيف أفعل)، والتخصص هو مجال التركيز والبراعة (ماذا أفعل)',
            'المهارة نظرية والتخصص عملي',
            'التخصص للمدراء والمهارة للموظفين'
          ],
          correctAnswerIndex: 1,
          explanation: 'المهارات هي الأدوات التي تمكنك من العمل، بينما التخصص هو المجال الذي تقرر أن تكون خبيراً فيه.'
        },
        {
          id: 'face4-q2',
          question: 'كيف تساهم المهارات العالية في "تقليل المخاطر"؟',
          options: [
            'المهارات لا علاقة لها بالمخاطر',
            'الكفاءة العالية تقلل من الأخطاء المكلفة وتزيد من دقة اتخاذ القرار',
            'بجعل المشروع معقداً جداً',
            'عن طريق توظيف عدد أقل من الناس'
          ],
          correctAnswerIndex: 1,
          explanation: 'كلما زادت مهارة رائد الأعمال وفريقه، قلت احتمالية الوقوع في أخطاء ساذجة قد تكلف المشروع وجوده.'
        },
        {
          id: 'face4-q3',
          question: 'أي من التالي يعتبر من المهارات الناعمة (Soft Skills) الضرورية للريادي؟',
          options: [
            'البرمجة والمحاسبة',
            'التواصل، القيادة، والذكاء العاطفي',
            'تشغيل الآلات الثقيلة',
            'كتابة العقود القانونية'
          ],
          correctAnswerIndex: 1,
          explanation: 'المهارات التقنية مهمة، لكن المهارات الناعمة هي التي تمكن الريادي من قيادة الفريق، التفاوض، وبيع رؤيته.'
        }
      ];

    case 'face5': // Market Need (احتياج السوق)
      return [
        {
          id: 'face5-q1',
          question: 'ما هي الخطوة الأولى والآمنة قبل البدء في تصنيع المنتج؟',
          options: [
            'تصميم الشعار (Logo)',
            'استئجار مكتب فخم',
            'دراسة احتياج السوق والتأكد من وجود مشكلة حقيقية تحتاج لحل',
            'تعيين موظفين'
          ],
          correctAnswerIndex: 2,
          explanation: 'البدء بدون التأكد من وجود احتياج حقيقي هو السبب الأول لفشل الشركات الناشئة.'
        },
        {
          id: 'face5-q2',
          question: 'لماذا نعتمد على "البيانات والإحصاءات" بدلاً من التخمين؟',
          options: [
            'لأن البيانات تجعل العرض يبدو جميلاً',
            'لأن البيانات تقدم حقائق موضوعية تقلل من مخاطر الفشل وتوجه القرار',
            'لأن التخمين دائماً خاطئ',
            'البيانات غير مهمة في المشاريع الصغيرة'
          ],
          correctAnswerIndex: 1,
          explanation: 'القرارات المبنية على الحدس فقط خطرة؛ البيانات توفر رؤية واضحة لسلوك المستهلك وحجم السوق.'
        },
        {
          id: 'face5-q3',
          question: 'ماذا يعني "الفجوة في السوق"؟',
          options: [
            'مكان فارغ في الرفوف',
            'حاجة غير ملباة أو مشكلة لا يوجد لها حل مرضٍ حالياً',
            'نقص في التمويل',
            'فترة ركود اقتصادي'
          ],
          correctAnswerIndex: 1,
          explanation: 'الفرصة الريادية الحقيقية تكمن في إيجاد هذه الفجوات (المشاكل غير المحلولة) وملئها بمنتجك.'
        }
      ];

    case 'face6': // Innovative Product (منتج مبتكر)
      return [
        {
          id: 'face6-q1',
          question: 'الابتكار في نموذج الأعمال يعني:',
          options: [
            'اختراع شيء لم يره أحد من قبل فقط',
            'تقديم قيمة مضافة وحل فعال بطريقة أفضل مما هو موجود (ليس شرطاً أن يكون اختراعاً)',
            'تغيير لون المنتج فقط',
            'استخدام التكنولوجيا المعقدة دائماً'
          ],
          correctAnswerIndex: 1,
          explanation: 'الابتكار هو خلق قيمة جديدة. قد يكون في طريقة التوصيل، التغليف، الخدمة، وليس شرطاً أن يكون اختراعاً تكنولوجياً.'
        },
        {
          id: 'face6-q2',
          question: 'كيف يحقق المنتج المبتكر "ميزة تنافسية"؟',
          options: [
            'بأن يكون الأرخص سعراً دائماً',
            'بأن يكون من الصعب على المنافسين تقليده ويقدم قيمة فريدة للعميل',
            'بأن يتم تسويقه بكثرة',
            'بأن يكون معقداً في الاستخدام'
          ],
          correctAnswerIndex: 1,
          explanation: 'المنتج المبتكر يخلق حاجزاً أمام المنافسين لأنهم لا يستطيعون نسخ القيمة الفريدة التي يقدمها بسهولة.'
        },
        {
          id: 'face6-q3',
          question: 'ما العلاقة بين الابتكار والاستدامة؟',
          options: [
            'الابتكار يضر بالاستدامة',
            'الابتكار يسمح للمشروع بالتطور والتكيف مع تغيرات السوق، مما يضمن بقاءه',
            'الاستدامة تعني عدم تغيير أي شيء',
            'لا توجد علاقة'
          ],
          correctAnswerIndex: 1,
          explanation: 'الأسواق تتغير، والشركات التي لا تبتكر تموت (مثل نوكيا وكوداك). الابتكار هو ضمان الاستمرار.'
        }
      ];

    case 'face7': // Money (المال)
      return [
        {
          id: 'face7-q1',
          question: 'وفقاً للنموذج، هل "المال" هو الهدف النهائي لريادة الأعمال؟',
          options: [
            'نعم، هو الهدف الوحيد',
            'لا، المال وسيلة ونتيجة لتقديم القيمة، وليس الغاية الوحيدة',
            'المال ليس مهماً إطلاقاً',
            'الهدف هو الشهرة فقط'
          ],
          correctAnswerIndex: 1,
          explanation: 'المال ضروري للاستمرار (كالوقود للسيارة)، لكنه ليس الوجهة النهائية. الوجهة هي الأثر والقيمة التي تقدمها.'
        },
        {
          id: 'face7-q2',
          question: 'أي أنواع رأس المال يعتبره النموذج "الأهم والأغلى"؟',
          options: [
            'رأس المال المالي (النقد)',
            'رأس المال البشري (فريق العمل والقيادة)',
            'رأس المال العقاري',
            'الأجهزة والمعدات'
          ],
          correctAnswerIndex: 1,
          explanation: 'يمكن تعويض المال، لكن العقول المبدعة، الفريق المتناغم، والقيادة الحكيمة (رأس المال البشري) هي التي تصنع المال.'
        },
        {
          id: 'face7-q3',
          question: 'ما هو دور "الحوكمة المالية" في المشروع؟',
          options: [
            'تعقيد الأمور على الموظفين',
            'ضمان الشفافية، النزاهة، وحماية حقوق المستثمرين واستدامة المشروع',
            'منع صرف الرواتب',
            'إخفاء الأرباح عن الضرائب'
          ],
          correctAnswerIndex: 1,
          explanation: 'الحوكمة تضمن أن يُدار المال بمسؤولية، مما يحمي الشركة من الفساد والانهيار ويبني الثقة مع الممولين.'
        }
      ];
      
    default:
      return undefined;
  }
};

export const getCourseStructure = (progress: UserProgress): CourseModule[] => {
  
  const modules: CourseModule[] = sectionToc.map((section, index) => {
    const modulePages = bookPages.filter(p => p.sectionId === section.id);
    
    const isCompleted = progress.completedModules.includes(section.id);
    
    // Logic: The first module is always unlocked. 
    // Subsequent modules are unlocked only if the PREVIOUS one is completed.
    let isLocked = false;
    if (index > 0) {
       const prevSectionId = sectionToc[index - 1].id;
       if (!progress.completedModules.includes(prevSectionId)) {
           isLocked = true;
       }
    }

    // Exceptions: Intro, Cover, Model Overview are always open and navigatable but have no quiz
    if (['cover', 'introduction', 'model-overview'].includes(section.id)) {
        isLocked = false;
    }

    let status: CourseModule['status'] = 'locked';
    if (isLocked) status = 'locked';
    else if (isCompleted) status = 'completed';
    else status = 'unlocked';

    // Use the new specific quiz generator
    const quiz = getQuizForSection(section.id);

    return {
      id: section.id,
      title: section.title,
      pages: modulePages,
      isLocked,
      status,
      quiz // Will be undefined for Intro, Cover, etc.
    };
  });

  return modules;
};
